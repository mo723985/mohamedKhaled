<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª (Web-Only)</title>
    <style>
        :root {
            --primary-color: #007bff;
            --secondary-color: #6c757d;
            --success-color: #28a745;
            --danger-color: #dc3545;
            --warning-color: #ffc107;
            --info-color: #17a2b8;
            --light-bg: #f8f9fa;
            --dark-text: #343a40;
            --border-color: #dee2e6;
            --font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            font-family: var(--font-family);
            margin: 0;
            background-color: var(--light-bg);
            color: var(--dark-text);
            text-align: right; /* Default text alignment for RTL */
        }

        /* General Layout & Utility */
        .container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 15px;
        }

        .alert {
            padding: 10px;
            margin-bottom: 15px;
            border-radius: 5px;
            text-align: center;
        }

        .alert-danger { background-color: #f8d7da; color: var(--danger-color); border: 1px solid #f5c6cb; }
        .alert-success { background-color: #d4edda; color: var(--success-color); border: 1px solid #c3e6cb; }
        .alert-warning { background-color: #fff3cd; color: var(--warning-color); border: 1px solid #ffeeba; }
        .alert-info { background-color: #d1ecf1; color: var(--info-color); border: 1px solid #bee5eb; }

        /* Buttons */
        .btn {
            padding: 8px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.2s;
            margin-left: 5px; /* Spacing between buttons */
            font-size: 14px;
        }

        .btn-primary { background-color: var(--primary-color); color: white; }
        .btn-primary:hover { background-color: #0056b3; }

        .btn-danger { background-color: var(--danger-color); color: white; }
        .btn-danger:hover { background-color: #bd2130; }

        .btn-success { background-color: var(--success-color); color: white; }
        .btn-success:hover { background-color: #1e7e34; }

        .btn-secondary { background-color: var(--secondary-color); color: white; }
        .btn-secondary:hover { background-color: #545b62; }

        .btn-sm { padding: 5px 10px; font-size: 12px; }

        /* Forms */
        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .form-control, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            box-sizing: border-box;
        }

        textarea {
            resize: vertical;
        }

        /* Tables */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background-color: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .data-table th, .data-table td {
            padding: 12px;
            border: 1px solid var(--border-color);
            text-align: right;
        }

        .data-table th {
            background-color: var(--info-color);
            color: white;
            font-weight: bold;
        }

        .data-table tr:nth-child(even) {
            background-color: #f2f2f2;
        }

        /* Navigation */
        .navbar {
            background-color: var(--dark-text);
            padding: 10px 0;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .navbar-nav {
            list-style: none;
            padding: 0;
            margin: 0;
            display: flex;
            justify-content: flex-start;
            flex-wrap: wrap;
        }

        .nav-item a {
            color: white;
            text-decoration: none;
            padding: 10px 15px;
            display: block;
            transition: background-color 0.2s;
        }

        .nav-item a:hover, .nav-item a.active {
            background-color: #495057;
        }

        .logout-btn {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            padding: 10px 15px;
            font-size: 16px;
            transition: color 0.2s;
        }

        .logout-btn:hover {
            color: var(--danger-color);
        }

        /* Section Display */
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--primary-color);
        }

        .content-section {
            display: none; /* Hide all sections by default */
        }
        
        /* Dashboard Cards */
        .dashboard-cards {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-top: 20px;
        }

        .card {
            flex: 1 1 calc(33.333% - 20px);
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            text-align: center;
            min-width: 250px;
        }

        .card h4 {
            margin-top: 0;
            color: var(--secondary-color);
            font-size: 16px;
        }

        .card p {
            font-size: 24px;
            font-weight: bold;
            margin: 5px 0 0;
        }
        
        /* Monthly Payments Specific */
        #payment-stats .card {
             flex: 1 1 calc(25% - 20px);
             min-width: 200px;
        }
        
        .paid-checkbox {
            transform: scale(1.5);
            cursor: pointer;
        }

        /* Login Overlay */
        #login-overlay {
            position: fixed;
            top: 0;
            right: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        #login-form-container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            width: 350px;
            text-align: center;
        }
        
        /* Media Queries for Responsiveness */
        @media (max-width: 768px) {
            .navbar-nav {
                flex-direction: column;
                align-items: stretch;
            }
            .nav-item a {
                text-align: center;
            }
            .card {
                flex: 1 1 100%;
            }
            #payment-stats .card {
                 flex: 1 1 100%;
            }
            .data-table, .data-table thead, .data-table tbody, .data-table th, .data-table td, .data-table tr { 
                display: block; 
            }
            .data-table thead tr { 
                position: absolute;
                top: -9999px;
                left: -9999px;
            }
            .data-table tr { border: 1px solid #ccc; margin-bottom: 10px; }
            .data-table td { 
                border: none;
                border-bottom: 1px solid #eee; 
                position: relative;
                padding-right: 50%; /* Adjust for label */
                text-align: right;
            }
            .data-table td:before { 
                /* Mobile column labels - customize for each table */
                position: absolute;
                top: 6px;
                right: 6px;
                width: 45%; 
                padding-left: 10px; 
                white-space: nowrap;
                font-weight: bold;
                content: attr(data-label);
                text-align: right;
            }
        }
    </style>
</head>
<body>

    <div id="login-overlay">
        <div id="login-form-container">
            <h2>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
            <div id="login-message" class="alert alert-danger" style="display: none;"></div>
            <form id="login-form">
                <div class="form-group">
                    <label for="password-input">ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±:</label>
                    <input type="password" id="password-input" class="form-control" required>
                </div>
                <button type="submit" class="btn btn-primary">Ø¯Ø®ÙˆÙ„</button>
            </form>
        </div>
    </div>

    <div id="app-content" style="display: none;">

        <nav class="navbar">
            <div class="container" style="display: flex; justify-content: space-between; align-items: center;">
                <ul class="navbar-nav">
                    <li class="nav-item"><a href="#" onclick="showSection('dashboard', this)">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© ğŸ </a></li>
                    <li class="nav-item"><a href="#" onclick="showSection('clients', this)">Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ ğŸ‘¤</a></li>
                    <li class="nav-item"><a href="#" onclick="showSection('packages', this)">Ø§Ù„Ø¨Ø§Ù‚Ø§Øª ğŸ“¦</a></li>
                    <li class="nav-item"><a href="#" onclick="showSection('groups', this)">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª ğŸ‘¥</a></li>
                    <li class="nav-item"><a href="#" onclick="showSection('payments', this)">Ø§Ù„Ø¯ÙØ¹ Ø§Ù„Ø´Ù‡Ø±ÙŠ ğŸ’°</a></li>
                    <li class="nav-item"><a href="#" onclick="showSection('debtors', this)">Ø§Ù„Ù…ØªØ£Ø®Ø±ÙŠÙ† ğŸš¨</a></li>
                    <li class="nav-item"><a href="#" onclick="showSection('reports', this)">Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± ğŸ“Š</a></li>
                    <li class="nav-item"><a href="#" onclick="showSection('settings', this)">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª âš™ï¸</a></li>
                    <li class="nav-item"><a href="#" onclick="showSection('backup', this)">Ù†Ø³Ø® Ø§Ø­ØªÙŠØ§Ø·ÙŠ ğŸ’¾</a></li>
                </ul>
                <button class="logout-btn" onclick="logout()">Ø®Ø±ÙˆØ¬ ğŸšª</button>
            </div>
        </nav>

        <div class="container">
            
            <section id="dashboard" class="content-section">
                <div class="section-header">
                    <h2>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</h2>
                </div>
                <div class="alert alert-info">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª.</div>
                <div id="dashboard-stats" class="dashboard-cards">
                    </div>
            </section>

            <section id="clients" class="content-section">
                <div class="section-header">
                    <h2>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</h2>
                    <button class="btn btn-primary" onclick="resetClientForm()">+ Ø¹Ù…ÙŠÙ„ Ø¬Ø¯ÙŠØ¯</button>
                </div>
                
                <div style="margin-bottom: 20px; display: flex; gap: 10px; flex-wrap: wrap; align-items: center;">
                    <input type="text" id="client-search" class="form-control" placeholder="Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø§Ù„Ø±Ù‚Ù…..." style="flex: 1;">
                    <select type="text" id="client-status-filter" class="form-control" style="width: 150px;">
                        <option value="all">ÙƒÙ„ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</option>
                        <option value="active">Ø§Ù„Ù†Ø´Ø·ÙˆÙ†</option>
                        <option value="inactive">Ø§Ù„Ù…ÙˆÙ‚ÙˆÙÙˆÙ†</option>
                    </select>
                    <select type="text" id="client-group-filter" class="form-control" style="width: 150px;">
                        <option value="all">ÙƒÙ„ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª</option>
                        </select>
                </div>

                <div id="client-form-container" style="background: white; padding: 15px; border-radius: 5px; margin-bottom: 20px; display: none;">
                    <h3>Ø¥Ø¶Ø§ÙØ©/ØªØ¹Ø¯ÙŠÙ„ Ø¹Ù…ÙŠÙ„</h3>
                    <form id="client-form">
                        <input type="hidden" id="client-id">
                        <div class="form-group">
                            <label for="client-name">Ø§Ù„Ø§Ø³Ù…:</label>
                            <input type="text" id="client-name" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="client-phone">Ø§Ù„Ø±Ù‚Ù… (Ù„Ù„Ø¥ØªØµØ§Ù„):</label>
                            <input type="tel" id="client-phone" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="client-package">Ø§Ù„Ø¨Ø§Ù‚Ø©:</label>
                            <select id="client-package" class="form-control" required></select>
                        </div>
                        <div class="form-group">
                            <label for="client-group">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©:</label>
                            <select id="client-group" class="form-control" required></select>
                        </div>
                        <div class="form-group" style="display: flex; align-items: center; gap: 10px;">
                            <input type="checkbox" id="client-active" style="transform: scale(1.2);">
                            <label for="client-active" style="margin-bottom: 0;">Ù†Ø´Ø·</label>
                        </div>
                        <button type="submit" class="btn btn-success" id="client-form-submit-btn">Ø¥Ø¶Ø§ÙØ©</button>
                        <button type="button" class="btn btn-secondary" onclick="document.getElementById('client-form-container').style.display='none';">Ø¥Ù„ØºØ§Ø¡</button>
                    </form>
                </div>

                <table id="clients-table" class="data-table">
                    <thead>
                        <tr>
                            <th>Ø§Ù„Ø§Ø³Ù…</th>
                            <th>Ø§Ù„Ø±Ù‚Ù…</th>
                            <th>Ø§Ù„Ø¨Ø§Ù‚Ø©</th>
                            <th>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©</th>
                            <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                            <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ø¶Ø§ÙØ©</th>
                            <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                        </tr>
                    </thead>
                    <tbody>
                        </tbody>
                </table>
            </section>

            <section id="packages" class="content-section">
                <div class="section-header">
                    <h2>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¨Ø§Ù‚Ø§Øª</h2>
                    <button class="btn btn-primary" onclick="resetPackageForm()">+ Ø¨Ø§Ù‚Ø© Ø¬Ø¯ÙŠØ¯Ø©</button>
                </div>
                
                <div id="package-form-container" style="background: white; padding: 15px; border-radius: 5px; margin-bottom: 20px; display: none;">
                    <h3>Ø¥Ø¶Ø§ÙØ©/ØªØ¹Ø¯ÙŠÙ„ Ø¨Ø§Ù‚Ø©</h3>
                    <form id="package-form">
                        <input type="hidden" id="package-id">
                        <div class="form-group">
                            <label for="package-name">Ø§Ø³Ù… Ø§Ù„Ø¨Ø§Ù‚Ø©:</label>
                            <input type="text" id="package-name" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="package-net">Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª (Ø¬ÙŠØ¬Ø§):</label>
                            <input type="number" id="package-net" class="form-control" min="0" required>
                        </div>
                        <div class="form-group">
                            <label for="package-minutes">Ø§Ù„Ø¯Ù‚Ø§Ø¦Ù‚:</label>
                            <input type="number" id="package-minutes" class="form-control" min="0" required>
                        </div>
                        <div class="form-group">
                            <label for="package-price">Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø´Ù‡Ø±ÙŠ:</label>
                            <input type="number" id="package-price" class="form-control" min="0" step="any" required>
                        </div>
                        <div class="form-group">
                            <label for="package-notes">Ù…Ù„Ø§Ø­Ø¸Ø§Øª:</label>
                            <textarea id="package-notes" class="form-control"></textarea>
                        </div>
                        <button type="submit" class="btn btn-success" id="package-form-submit-btn">Ø¥Ø¶Ø§ÙØ©</button>
                        <button type="button" class="btn btn-secondary" onclick="document.getElementById('package-form-container').style.display='none';">Ø¥Ù„ØºØ§Ø¡</button>
                    </form>
                </div>

                <table id="packages-table" class="data-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Ø§Ù„Ø§Ø³Ù…</th>
                            <th>Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª (Ø¬ÙŠØ¬Ø§)</th>
                            <th>Ø§Ù„Ø¯Ù‚Ø§Ø¦Ù‚</th>
                            <th>Ø§Ù„Ø³Ø¹Ø±</th>
                            <th>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th>
                            <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                        </tr>
                    </thead>
                    <tbody>
                        </tbody>
                </table>
            </section>
            
            <section id="groups" class="content-section">
                <div class="section-header">
                    <h2>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª</h2>
                    <button class="btn btn-primary" onclick="resetGroupForm()">+ Ù…Ø¬Ù…ÙˆØ¹Ø© Ø¬Ø¯ÙŠØ¯Ø©</button>
                </div>

                <div id="group-form-container" style="background: white; padding: 15px; border-radius: 5px; margin-bottom: 20px; display: none;">
                    <h3>Ø¥Ø¶Ø§ÙØ©/ØªØ¹Ø¯ÙŠÙ„ Ù…Ø¬Ù…ÙˆØ¹Ø©</h3>
                    <form id="group-form">
                        <input type="hidden" id="group-id">
                        <div class="form-group">
                            <label for="group-name">Ø§Ø³Ù… Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©:</label>
                            <input type="text" id="group-name" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="group-phone">Ù‡Ø§ØªÙ Ù…Ø³Ø¤ÙˆÙ„ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©:</label>
                            <input type="tel" id="group-phone" class="form-control">
                        </div>
                        <button type="submit" class="btn btn-success" id="group-form-submit-btn">Ø¥Ø¶Ø§ÙØ©</button>
                        <button type="button" class="btn btn-secondary" onclick="document.getElementById('group-form-container').style.display='none';">Ø¥Ù„ØºØ§Ø¡</button>
                    </form>
                </div>

                <table id="groups-table" class="data-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Ø§Ù„Ø§Ø³Ù…</th>
                            <th>Ù‡Ø§ØªÙ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„</th>
                            <th>Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</th>
                            <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                        </tr>
                    </thead>
                    <tbody>
                        </tbody>
                </table>
            </section>


            <section id="payments" class="content-section">
                <div class="section-header">
                    <h2>Ø§Ù„Ø¯ÙØ¹ Ø§Ù„Ø´Ù‡Ø±ÙŠ</h2>
                </div>
                
                <div style="display: flex; gap: 10px; margin-bottom: 20px; align-items: center;">
                    <label for="payment-month">Ø§Ù„Ø´Ù‡Ø±:</label>
                    <input type="number" id="payment-month" class="form-control" min="1" max="12" style="width: 80px;" onchange="renderPayments()">
                    <label for="payment-year">Ø§Ù„Ø³Ù†Ø©:</label>
                    <input type="number" id="payment-year" class="form-control" style="width: 100px;" onchange="renderPayments()">
                    <button class="btn btn-primary" onclick="createMonthlyRecords()">Ø¥Ù†Ø´Ø§Ø¡ Ø´Ù‡Ø± Ø¬Ø¯ÙŠØ¯</button>
                </div>
                
                <div id="payment-message" class="alert" style="display: none;"></div>
                
                <div id="payment-stats" class="dashboard-cards">
                    <div class="card bg-info"><h4>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ØªÙˆÙ‚Ø¹</h4><p id="stat-expected">0.00</p></div>
                    <div class="card bg-success"><h4>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¯ÙÙˆØ¹</h4><p id="stat-paid">0.00</p></div>
                    <div class="card bg-danger"><h4>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ØªØ£Ø®Ø±</h4><p id="stat-due">0.00</p></div>
                    <div class="card bg-warning"><h4>Ù†Ø³Ø¨Ø© Ø§Ù„ØªØ­ØµÙŠÙ„</h4><p id="stat-ratio">0%</p></div>
                </div>

                <table id="payments-table" class="data-table">
                    <thead>
                        <tr>
                            <th>Ø§Ù„Ø¹Ù…ÙŠÙ„</th>
                            <th>Ø§Ù„Ø¨Ø§Ù‚Ø©</th>
                            <th>Ø§Ù„Ø±Ù‚Ù…</th>
                            <th>Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø£ØµÙ„ÙŠ</th>
                            <th>Ø§Ù„Ø®ØµÙ…</th>
                            <th>Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</th>
                            <th>ØªÙ… Ø§Ù„Ø¯ÙØ¹ØŸ</th>
                            <th>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th>
                            <th>Ø±Ø³Ø§Ù„Ø© SMS</th>
                        </tr>
                    </thead>
                    <tbody>
                        </tbody>
                </table>
            </section>

            <section id="debtors" class="content-section">
                <div class="section-header">
                    <h2>Ø§Ù„Ù…ØªØ£Ø®Ø±ÙŠÙ† Ø¹Ù† Ø§Ù„Ø¯ÙØ¹</h2>
                </div>
                
                <div class="alert alert-warning">
                    <p><strong>Ù‚Ø§Ù„Ø¨ Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ°ÙƒÙŠØ± (SMS):</strong></p>
                    <textarea id="sms-template-input" class="form-control" rows="3" onchange="saveSmsTemplate()"></textarea>
                    <small>Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ù…Ø¯Ø¹ÙˆÙ…Ø©: <mark>{{name}}</mark>, <mark>{{month}}</mark>, <mark>{{year}}</mark>, <mark>{{amount}}</mark>.</small>
                    <button class="btn btn-secondary btn-sm" onclick="resetSmsTemplate()" style="margin-top: 5px;">Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù‚Ø§Ù„Ø¨ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ</button>
                </div>

                <div style="margin-bottom: 20px;">
                    <button class="btn btn-danger" onclick="sendBulkSmsReminder()">
                        Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© Ù„ÙƒÙ„ Ø§Ù„Ù…ØªØ£Ø®Ø±ÙŠÙ† âš ï¸
                    </button>
                    <p class="alert alert-info">
                        Ù…Ù„Ø§Ø­Ø¸Ø©: Ø¨Ø¹Ø¶ Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© Ù„Ø§ ØªØ¯Ø¹Ù… Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ø¦Ù„ Ø¬Ù…Ø§Ø¹ÙŠØ© ÙÙŠ Ø±Ø§Ø¨Ø· SMS. Ø³ÙŠØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… ØµÙŠØºØ© Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ù…ÙØµÙˆÙ„Ø© Ø¨ÙÙˆØ§ØµÙ„.
                    </p>
                </div>

                <table id="debtors-table" class="data-table">
                    <thead>
                        <tr>
                            <th>Ø§Ù„Ø¹Ù…ÙŠÙ„</th>
                            <th>Ø§Ù„Ø±Ù‚Ù…</th>
                            <th>Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…ØªØ£Ø®Ø±</th>
                            <th>Ø¹Ø¯Ø¯ Ø§Ù„ØªØ°ÙƒÙŠØ±Ø§Øª</th>
                            <th>Ø¢Ø®Ø± ØªØ°ÙƒÙŠØ±</th>
                            <th>Ø¥Ø±Ø³Ø§Ù„ SMS</th>
                        </tr>
                    </thead>
                    <tbody>
                        </tbody>
                </table>
            </section>
            
            <section id="backup" class="content-section">
                <div class="section-header">
                    <h2>Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ ÙˆØ§Ù„Ø§Ø³ØªØ¹Ø§Ø¯Ø©</h2>
                </div>
                
                <div style="background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                    <h3>ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (Backup)</h3>
                    <p>Ù‚Ù… Ø¨ØªÙ†Ø²ÙŠÙ„ Ù…Ù„Ù JSON ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù….</p>
                    <button class="btn btn-primary" onclick="exportDataToJSON()">ØªØµØ¯ÙŠØ± JSON â¬‡ï¸</button>
                </div>

                <div style="background: white; padding: 20px; border-radius: 8px;">
                    <h3>Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (Restore)</h3>
                    <p class="alert alert-danger">ØªØ­Ø°ÙŠØ±: Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø³ÙŠØ³ØªØ¨Ø¯Ù„ **Ø¬Ù…ÙŠØ¹** Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©!</p>
                    <input type="file" id="import-file-input" accept="application/json" style="margin-bottom: 10px;">
                    <button class="btn btn-danger" onclick="importDataFromInput()">Ø§Ø³ØªÙŠØ±Ø§Ø¯ JSON â¬†ï¸</button>
                </div>
            </section>

            <section id="settings" class="content-section">
                <div class="section-header">
                    <h2>Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</h2>
                </div>

                <div style="background: white; padding: 20px; border-radius: 8px;">
                    <h3>ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±</h3>
                    <div id="password-message" class="alert" style="display: none;"></div>
                    <form id="change-password-form" onsubmit="changePassword(event)">
                        <div class="form-group">
                            <label for="old-password">ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©:</label>
                            <input type="password" id="old-password" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="new-password">ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©:</label>
                            <input type="password" id="new-password" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="confirm-new-password">ØªØ£ÙƒÙŠØ¯ ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©:</label>
                            <input type="password" id="confirm-new-password" class="form-control" required>
                        </div>
                        <button type="submit" class="btn btn-primary">ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±</button>
                    </form>
                </div>
            </section>
            
            <section id="reports" class="content-section">
                <div class="section-header">
                    <h2>Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± ÙˆØ§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</h2>
                </div>

                <div id="reports-stats" class="dashboard-cards">
                    </div>
                
                <div style="margin-top: 30px; background: white; padding: 20px; border-radius: 8px;">
                    <h3>Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª</h3>
                    <table id="group-reports-table" class="data-table">
                        <thead>
                            <tr>
                                <th>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©</th>
                                <th>Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</th>
                                <th>Ø¹Ù…Ù„Ø§Ø¡ Ù†Ø´Ø·ÙˆÙ†</th>
                                <th>Ø¹Ù…Ù„Ø§Ø¡ Ù…ÙˆÙ‚ÙˆÙÙˆÙ†</th>
                            </tr>
                        </thead>
                        <tbody>
                            </tbody>
                    </table>
                </div>

                <div style="margin-top: 30px; background: white; padding: 20px; border-radius: 8px;">
                    <h3>Ù…Ù„Ø®Øµ Ø§Ù„Ø¯ÙØ¹ Ø§Ù„Ø´Ù‡Ø±ÙŠ Ø§Ù„Ø­Ø§Ù„ÙŠ</h3>
                    <div id="monthly-payment-summary">
                        </div>
                </div>
            </section>

        </div>
    </div>
    
    <script>
        // --- âš™ï¸ Ù…ØªØºÙŠØ±Ø§Øª ÙˆØ«ÙˆØ§Ø¨Øª Ø¹Ø§Ù…Ø© -----------------------------------------------------------------------------------------------------------------------------------
        
        // Ù…ÙØ§ØªÙŠØ­ localStorage
        const STORAGE_KEYS = {
            CLIENTS: 'clients',
            PACKAGES: 'packages',
            GROUPS: 'groups',
            PAYMENTS: 'payments',
            SMS_TEMPLATE: 'smsReminderTemplate',
            PASSWORD: 'appPassword',
            LOGGED_IN: 'loggedIn',
            LAST_MONTH: 'lastSelectedMonth',
            LAST_YEAR: 'lastSelectedYear'
        };

        const DEFAULT_PASSWORD = '1997';
        const DEFAULT_SMS_TEMPLATE = "Ø¹Ø²ÙŠØ²ÙŠ {{name}}ØŒ Ù†Ø±Ø¬Ùˆ Ø§Ù„ØªÙƒØ±Ù… Ø¨Ø¯ÙØ¹ ÙØ§ØªÙˆØ±Ø© Ø§Ø´ØªØ±Ø§Ùƒ Ø§Ù„Ø´Ù‡Ø± {{month}}/{{year}} Ø¨Ù‚ÙŠÙ…Ø© {{amount}}ØŒ Ø´ÙƒØ±Ø§Ù‹ Ù„ØªØ¹Ø§ÙˆÙ†ÙƒÙ….";
        
        // Ø¨ÙŠØ§Ù†Ø§Øª Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ø¥Ø°Ø§ ÙƒØ§Ù† localStorage ÙØ§Ø±ØºØ§Ù‹
        const DUMMY_DATA = {
            packages: [
                { id: 1, name: "Ø¨Ø§Ù‚Ø© 25 Ø¬ÙŠØ¬Ø§", net: 25, minutes: 100, price: 150.00, notes: "Ø¨Ø§Ù‚Ø© Ù‚ÙŠØ§Ø³ÙŠØ©" },
                { id: 2, name: "Ø¨Ø§Ù‚Ø© Ø¨Ù„Ø§ Ø­Ø¯ÙˆØ¯", net: 999, minutes: 500, price: 300.00, notes: "Ø£ÙØ¶Ù„ Ù‚ÙŠÙ…Ø©" }
            ],
            groups: [
                { id: 101, name: "Ù…Ù†Ø·Ù‚Ø© Ø£", phone: "0501234567" },
                { id: 102, name: "Ù…Ù†Ø·Ù‚Ø© Ø¨", phone: "0507654321" }
            ],
            clients: [
                { id: 1001, name: "Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯", phone: "0551112222", packageId: 1, groupId: 101, active: true, createdAt: new Date().toISOString() },
                { id: 1002, name: "ÙØ§Ø·Ù…Ø© Ø³Ø¹ÙŠØ¯", phone: "0563334444", packageId: 2, groupId: 102, active: true, createdAt: new Date().toISOString() },
                { id: 1003, name: "Ø®Ø§Ù„Ø¯ Ø¹Ù„ÙŠ", phone: "0505556666", packageId: 1, groupId: 101, active: false, createdAt: new Date().toISOString() }
            ]
        };

        // Ù„ØªØ±Ø¬Ù…Ø© Ø§Ù„Ø£Ø´Ù‡Ø±
        const MONTH_NAMES = [
            "ÙŠÙ†Ø§ÙŠØ±", "ÙØ¨Ø±Ø§ÙŠØ±", "Ù…Ø§Ø±Ø³", "Ø£Ø¨Ø±ÙŠÙ„", "Ù…Ø§ÙŠÙˆ", "ÙŠÙˆÙ†ÙŠÙˆ",
            "ÙŠÙˆÙ„ÙŠÙˆ", "Ø£ØºØ³Ø·Ø³", "Ø³Ø¨ØªÙ…Ø¨Ø±", "Ø£ÙƒØªÙˆØ¨Ø±", "Ù†ÙˆÙÙ…Ø¨Ø±", "Ø¯ÙŠØ³Ù…Ø¨Ø±"
        ];
        
        // --- ğŸ’¾ Ø¯ÙˆØ§Ù„ ØªØ®Ø²ÙŠÙ† localStorage Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© ---------------------------------------------------------------------------------------------------------------------

        /**
         * @function getFromStorage
         * @description ÙŠØ¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† localStorageØŒ ÙŠØ¹ÙŠØ¯ Ù…ØµÙÙˆÙØ© ÙØ§Ø±ØºØ© Ø£Ùˆ Ù‚ÙŠÙ…Ø© Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ø¥Ø°Ø§ Ù„Ù… ÙŠØ¬Ø¯ Ø´ÙŠØ¦Ø§Ù‹.
         * @param {string} key - Ù…ÙØªØ§Ø­ Ø§Ù„ØªØ®Ø²ÙŠÙ†.
         * @param {any} defaultValue - Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ø¥Ø°Ø§ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙØªØ§Ø­.
         * @returns {any} Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø®Ø²Ù†Ø© Ø£Ùˆ Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©.
         */
        function getFromStorage(key, defaultValue = []) {
            const data = localStorage.getItem(key);
            if (data === null || data === undefined) return defaultValue;
            
            // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø®Ø§ØµØ© Ù„Ù„Ù…ÙØªØ§Ø­ loggedIn Ùˆ appPassword Ø§Ù„ØªÙŠ Ù‚Ø¯ ØªÙƒÙˆÙ† Ù‚ÙŠÙ…Ù‡Ø§ Ù†ØµÙˆØµÙ‹Ø§ Ø¨Ø³ÙŠØ·Ø©
            if (key === STORAGE_KEYS.LOGGED_IN) {
                return data; // ÙŠØ¹ÙŠØ¯ "true" Ø£Ùˆ "false" ÙƒÙ†Øµ
            }
            if (key === STORAGE_KEYS.PASSWORD || key === STORAGE_KEYS.SMS_TEMPLATE) {
                 return data; // ÙŠØ¹ÙŠØ¯ Ø§Ù„Ù†Øµ Ù…Ø¨Ø§Ø´Ø±Ø©
            }

            try {
                return JSON.parse(data);
            } catch (e) {
                console.error(`Error parsing localStorage key ${key}:`, e);
                return defaultValue;
            }
        }

        /**
         * @function saveToStorage
         * @description ÙŠØ­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ù„Ù‰ localStorage.
         * @param {string} key - Ù…ÙØªØ§Ø­ Ø§Ù„ØªØ®Ø²ÙŠÙ†.
         * @param {any} data - Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø±Ø§Ø¯ Ø­ÙØ¸Ù‡Ø§.
         */
        function saveToStorage(key, data) {
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ø§ Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØªØ­ØªØ§Ø¬ Ø¥Ù„Ù‰ ØªØ­ÙˆÙŠÙ„ JSON
            const isJsonData = Array.isArray(data) || (typeof data === 'object' && data !== null);
            
            if (isJsonData) {
                 localStorage.setItem(key, JSON.stringify(data));
            } else {
                 localStorage.setItem(key, data);
            }
        }

        /**
         * @function initializeData
         * @description ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ø¹Ù†Ø¯ Ø£ÙˆÙ„ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù„Ù„ØªØ·Ø¨ÙŠÙ‚.
         */
        function initializeData() {
            // ØªÙ‡ÙŠØ¦Ø© ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± Ø¥Ø°Ø§ Ù„Ù… ØªÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯Ø©
            if (localStorage.getItem(STORAGE_KEYS.PASSWORD) === null) {
                saveToStorage(STORAGE_KEYS.PASSWORD, DEFAULT_PASSWORD);
            }

            // ØªÙ‡ÙŠØ¦Ø© Ù‚Ø§Ù„Ø¨ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹
            if (localStorage.getItem(STORAGE_KEYS.SMS_TEMPLATE) === null) {
                saveToStorage(STORAGE_KEYS.SMS_TEMPLATE, DEFAULT_SMS_TEMPLATE);
            }

            // ØªÙ‡ÙŠØ¦Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ØŒ Ø§Ù„Ø¨Ø§Ù‚Ø§ØªØŒ ÙˆØ§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ø¥Ø°Ø§ ÙƒØ§Ù†Øª ÙØ§Ø±ØºØ©
            if (getFromStorage(STORAGE_KEYS.CLIENTS).length === 0) {
                saveToStorage(STORAGE_KEYS.PACKAGES, DUMMY_DATA.packages);
                saveToStorage(STORAGE_KEYS.GROUPS, DUMMY_DATA.groups);
                saveToStorage(STORAGE_KEYS.CLIENTS, DUMMY_DATA.clients);
            }
        }

        // --- 1. Ø¯ÙˆØ§Ù„ Ø§Ù„Ø­Ù…Ø§ÙŠØ© Ø¨ÙƒÙ„Ù…Ø© Ø³Ø± (Login) -----------------------------------------------------------------------------------------------------------------------
        
        /**
         * @function checkLoginStatus
         * @description ØªØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø§Ù„Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙˆØªÙØ¸Ù‡Ø±/ØªÙØ®ÙÙŠ Ø§Ù„Ù€ overlay.
         */
        function checkLoginStatus() {
            // Ù†Ø³ØªØ®Ø¯Ù… getFromStorage Ø§Ù„ØªÙŠ ØªÙ… ØªØ¹Ø¯ÙŠÙ„Ù‡Ø§ Ù„Ø¥Ø±Ø¬Ø§Ø¹ Ø§Ù„Ù‚ÙŠÙ…Ø© ÙƒÙ†Øµ
            const loggedIn = getFromStorage(STORAGE_KEYS.LOGGED_IN, 'false') === 'true'; 
            const overlay = document.getElementById('login-overlay');
            const content = document.getElementById('app-content');

            if (loggedIn) {
                overlay.style.display = 'none';
                content.style.display = 'block';
                // Ø¹Ø±Ø¶ Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ (Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©)
                showSection('dashboard', document.querySelector('.nav-item a'));
            } else {
                overlay.style.display = 'flex';
                content.style.display = 'none';
            }
        }

        /**
         * @function login
         * @description Ù…Ø¹Ø§Ù„Ø¬Ø© Ù…Ø­Ø§ÙˆÙ„Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„.
         * @param {Event} event - Ø­Ø¯Ø« ØªÙ‚Ø¯ÙŠÙ… Ø§Ù„ÙÙˆØ±Ù….
         */
        document.getElementById('login-form').addEventListener('submit', function(event) {
            event.preventDefault();
            const passwordInput = document.getElementById('password-input').value;
            // ÙŠØªÙ… Ø¬Ù„Ø¨ ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± ÙƒÙ€ Ù†Øµ
            const storedPassword = getFromStorage(STORAGE_KEYS.PASSWORD, DEFAULT_PASSWORD); 
            const messageEl = document.getElementById('login-message');

            if (passwordInput === storedPassword) {
                saveToStorage(STORAGE_KEYS.LOGGED_IN, 'true'); // Ø­ÙØ¸ ÙƒÙ†Øµ
                messageEl.style.display = 'none';
                document.getElementById('login-overlay').style.display = 'none';
                document.getElementById('app-content').style.display = 'block';
                // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø¨Ø¹Ø¯ Ø§Ù„Ø¯Ø®ÙˆÙ„
                showSection('dashboard', document.querySelector('.nav-item a'));
                initializeInterface(); 
            } else {
                messageEl.textContent = 'ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± ØºÙŠØ± ØµØ­ÙŠØ­Ø©.';
                messageEl.style.display = 'block';
                messageEl.className = 'alert alert-danger';
            }
        });

        /**
         * @function logout
         * @description ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ ÙˆØ­Ø°Ù Ø­Ø§Ù„Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙˆØ¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©.
         */
        function logout() {
            if (confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ØŸ")) {
                localStorage.removeItem(STORAGE_KEYS.LOGGED_IN);
                location.reload();
            }
        }

        /**
         * @function changePassword
         * @description ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± Ø¨Ø¹Ø¯ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©.
         * @param {Event} event - Ø­Ø¯Ø« ØªÙ‚Ø¯ÙŠÙ… Ø§Ù„ÙÙˆØ±Ù….
         */
        function changePassword(event) {
            event.preventDefault();
            const oldPass = document.getElementById('old-password').value;
            const newPass = document.getElementById('new-password').value;
            const confirmNewPass = document.getElementById('confirm-new-password').value;
            const messageEl = document.getElementById('password-message');
            // Ø¬Ù„Ø¨ ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± Ø§Ù„Ù…Ø®Ø²Ù†Ø© ÙƒÙ†Øµ
            const storedPassword = getFromStorage(STORAGE_KEYS.PASSWORD, DEFAULT_PASSWORD); 

            messageEl.style.display = 'none';

            if (oldPass !== storedPassword) {
                messageEl.textContent = 'ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© ØºÙŠØ± ØµØ­ÙŠØ­Ø©.';
                messageEl.className = 'alert alert-danger';
                messageEl.style.display = 'block';
                return;
            }

            if (newPass !== confirmNewPass) {
                messageEl.textContent = 'ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ÙˆØªØ£ÙƒÙŠØ¯Ù‡Ø§ ØºÙŠØ± Ù…ØªØ·Ø§Ø¨Ù‚ÙŠÙ†.';
                messageEl.className = 'alert alert-danger';
                messageEl.style.display = 'block';
                return;
            }

            if (newPass.length < 5) {
                messageEl.textContent = 'ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© 5 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„.';
                messageEl.className = 'alert alert-danger';
                messageEl.style.display = 'block';
                return;
            }

            // Ø­ÙØ¸ ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ÙƒÙ†Øµ
            saveToStorage(STORAGE_KEYS.PASSWORD, newPass); 
            messageEl.textContent = 'ØªÙ… ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± Ø¨Ù†Ø¬Ø§Ø­!';
            messageEl.className = 'alert alert-success';
            messageEl.style.display = 'block';
            document.getElementById('change-password-form').reset();
        }

        // --- 2. Ø¯ÙˆØ§Ù„ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¨Ø§Ù‚Ø§Øª (Packages) ---------------------------------------------------------------------------------------------------------------------

        /**
         * @function generateUniqueId
         * @description ØªÙˆÙ„ÙŠØ¯ Ø±Ù‚Ù… ID ÙØ±ÙŠØ¯ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø­Ø§Ù„ÙŠ.
         * @returns {number} ID ÙØ±ÙŠØ¯.
         */
        function generateUniqueId() {
            return Date.now();
        }

        /**
         * @function savePackage
         * @description Ø¥Ø¶Ø§ÙØ© Ø£Ùˆ ØªØ¹Ø¯ÙŠÙ„ Ø¨Ø§Ù‚Ø©.
         * @param {Event} event - Ø­Ø¯Ø« ØªÙ‚Ø¯ÙŠÙ… Ø§Ù„ÙÙˆØ±Ù….
         */
        document.getElementById('package-form').addEventListener('submit', function(event) {
            event.preventDefault();
            const id = document.getElementById('package-id').value;
            const packages = getFromStorage(STORAGE_KEYS.PACKAGES);

            const newPackage = {
                id: id ? parseInt(id) : generateUniqueId(),
                name: document.getElementById('package-name').value,
                net: parseFloat(document.getElementById('package-net').value),
                minutes: parseInt(document.getElementById('package-minutes').value),
                price: parseFloat(document.getElementById('package-price').value).toFixed(2),
                notes: document.getElementById('package-notes').value
            };

            if (id) {
                // ØªØ¹Ø¯ÙŠÙ„
                const index = packages.findIndex(p => p.id === newPackage.id);
                if (index !== -1) packages[index] = newPackage;
            } else {
                // Ø¥Ø¶Ø§ÙØ©
                packages.push(newPackage);
            }

            saveToStorage(STORAGE_KEYS.PACKAGES, packages);
            document.getElementById('package-form-container').style.display = 'none';
            renderPackages();
            populateClientPackageOptions();
            // ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø§Øª Ø£Ø®Ø±Ù‰ ØªØ¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø¨Ø§Ù‚Ø§Øª
            renderClients();
            renderPayments();
        });

        /**
         * @function deletePackage
         * @description Ø­Ø°Ù Ø¨Ø§Ù‚Ø© Ø¨Ø¹Ø¯ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡Ø§.
         * @param {number} packageId - ID Ø§Ù„Ø¨Ø§Ù‚Ø©.
         */
        function deletePackage(packageId) {
            const clients = getFromStorage(STORAGE_KEYS.CLIENTS);
            const isUsed = clients.some(c => c.packageId === packageId);
            
            if (isUsed) {
                if (!confirm("ØªÙ†Ø¨ÙŠÙ‡: Ù‡Ø°Ù‡ Ø§Ù„Ø¨Ø§Ù‚Ø© Ù…Ø³ØªØ®Ø¯Ù…Ø© Ù…Ù† Ø¹Ù…Ù„Ø§Ø¡. Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø­Ø°ÙØŸ Ø³ÙŠØªÙ… Ø­Ø°Ù Ø§Ù„Ø¨Ø§Ù‚Ø© ÙˆÙ„Ù† ÙŠØªÙ… Ø±Ø¨Ø· Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø¨Ù‡Ø§ Ù…Ø¬Ø¯Ø¯Ø§Ù‹.")) {
                    return;
                }
            } else {
                if (!confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ø£Ù†Ùƒ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ø¨Ø§Ù‚Ø© Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŸ")) {
                    return;
                }
            }
            
            let packages = getFromStorage(STORAGE_KEYS.PACKAGES);
            packages = packages.filter(p => p.id !== packageId);
            saveToStorage(STORAGE_KEYS.PACKAGES, packages);
            
            // ÙŠÙ…ÙƒÙ† ØªØ¹ÙŠÙŠÙ† packageId Ù„Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø§Ù„Ù…Ø±ØªØ¨Ø·ÙŠÙ† Ø¨Ù€ null
            
            renderPackages();
            populateClientPackageOptions();
            renderClients();
        }

        /**
         * @function editPackage
         * @description ØªØ¹Ø¨Ø¦Ø© ÙÙˆØ±Ù… Ø§Ù„Ø¨Ø§Ù‚Ø§Øª Ù„ØºØ±Ø¶ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„.
         * @param {number} packageId - ID Ø§Ù„Ø¨Ø§Ù‚Ø©.
         */
        function editPackage(packageId) {
            const packages = getFromStorage(STORAGE_KEYS.PACKAGES);
            const pkg = packages.find(p => p.id === packageId);

            if (pkg) {
                document.getElementById('package-id').value = pkg.id;
                document.getElementById('package-name').value = pkg.name;
                document.getElementById('package-net').value = pkg.net;
                document.getElementById('package-minutes').value = pkg.minutes;
                document.getElementById('package-price').value = pkg.price;
                document.getElementById('package-notes').value = pkg.notes;
                
                document.getElementById('package-form-submit-btn').textContent = 'ØªØ¹Ø¯ÙŠÙ„';
                document.getElementById('package-form-container').style.display = 'block';
            }
        }
        
        /**
         * @function resetPackageForm
         * @description ØªÙ‡ÙŠØ¦Ø© ÙÙˆØ±Ù… Ø§Ù„Ø¨Ø§Ù‚Ø§Øª Ù„Ù„Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©.
         */
        function resetPackageForm() {
            document.getElementById('package-form').reset();
            document.getElementById('package-id').value = '';
            document.getElementById('package-form-submit-btn').textContent = 'Ø¥Ø¶Ø§ÙØ©';
            document.getElementById('package-form-container').style.display = 'block';
        }

        /**
         * @function renderPackages
         * @description Ø¹Ø±Ø¶ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¨Ø§Ù‚Ø§Øª.
         */
        function renderPackages() {
            const packages = getFromStorage(STORAGE_KEYS.PACKAGES);
            const tableBody = document.getElementById('packages-table').getElementsByTagName('tbody')[0];
            tableBody.innerHTML = '';
            
            packages.forEach(pkg => {
                const row = tableBody.insertRow();
                row.innerHTML = `
                    <td data-label="ID">${pkg.id}</td>
                    <td data-label="Ø§Ù„Ø§Ø³Ù…">${pkg.name}</td>
                    <td data-label="Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª">${pkg.net}</td>
                    <td data-label="Ø§Ù„Ø¯Ù‚Ø§Ø¦Ù‚">${pkg.minutes}</td>
                    <td data-label="Ø§Ù„Ø³Ø¹Ø±">${parseFloat(pkg.price).toFixed(2)}</td>
                    <td data-label="Ù…Ù„Ø§Ø­Ø¸Ø§Øª">${pkg.notes}</td>
                    <td data-label="Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª">
                        <button class="btn btn-sm btn-info" onclick="editPackage(${pkg.id})">ØªØ¹Ø¯ÙŠÙ„</button>
                        <button class="btn btn-sm btn-danger" onclick="deletePackage(${pkg.id})">Ø­Ø°Ù</button>
                    </td>
                `;
            });
        }


        // --- 3. Ø¯ÙˆØ§Ù„ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ (Clients) -----------------------------------------------------------------------------------------------------------------------

        /**
         * @function saveClient
         * @description Ø¥Ø¶Ø§ÙØ© Ø£Ùˆ ØªØ¹Ø¯ÙŠÙ„ Ø¹Ù…ÙŠÙ„. (ÙŠØªÙ… Ø§Ø³ØªØ¯Ø¹Ø§Ø¤Ù‡Ø§ Ù…Ù† Ø¥ÙŠÙÙ†Øª submit ÙÙˆØ±Ù…Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡)
         */
        document.getElementById('client-form').addEventListener('submit', function(event) {
            event.preventDefault();
            const id = document.getElementById('client-id').value;
            let clients = getFromStorage(STORAGE_KEYS.CLIENTS);

            const newClient = {
                id: id ? parseInt(id) : generateUniqueId(),
                name: document.getElementById('client-name').value,
                phone: document.getElementById('client-phone').value,
                packageId: parseInt(document.getElementById('client-package').value),
                groupId: parseInt(document.getElementById('client-group').value),
                active: document.getElementById('client-active').checked,
                createdAt: id ? clients.find(c => c.id === parseInt(id)).createdAt : new Date().toISOString()
            };

            if (id) {
                // ØªØ¹Ø¯ÙŠÙ„
                const index = clients.findIndex(c => c.id === newClient.id);
                if (index !== -1) clients[index] = newClient;
            } else {
                // Ø¥Ø¶Ø§ÙØ©
                clients.push(newClient);
            }

            saveToStorage(STORAGE_KEYS.CLIENTS, clients);
            document.getElementById('client-form-container').style.display = 'none';
            renderClients();
            renderGroups(); // Ù‚Ø¯ ØªØ¤Ø«Ø± Ø¹Ù„Ù‰ Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ ÙÙŠ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©
        });


        /**
         * @function deleteClient
         * @description Ø­Ø°Ù Ø¹Ù…ÙŠÙ„ Ù†Ù‡Ø§Ø¦ÙŠÙ‹Ø§ Ù…Ø¹ Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø¯ÙØ¹ Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø© Ø¨Ù‡.
         * @param {number} clientId - ID Ø§Ù„Ø¹Ù…ÙŠÙ„.
         */
        function deleteClient(clientId) {
            if (!confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ø£Ù†Ùƒ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ø§Ù„Ø¹Ù…ÙŠÙ„ Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŸ Ø³ÙŠØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø¯ÙØ¹ Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø© Ø¨Ù‡.")) {
                return;
            }

            // 1. Ø­Ø°Ù Ø§Ù„Ø¹Ù…ÙŠÙ„
            let clients = getFromStorage(STORAGE_KEYS.CLIENTS);
            clients = clients.filter(c => c.id !== clientId);
            saveToStorage(STORAGE_KEYS.CLIENTS, clients);

            // 2. Ø­Ø°Ù Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø¯ÙØ¹ Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø©
            let payments = getFromStorage(STORAGE_KEYS.PAYMENTS);
            payments = payments.filter(p => p.clientId !== clientId);
            saveToStorage(STORAGE_KEYS.PAYMENTS, payments);

            // 3. ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø§Øª
            renderClients();
            renderGroups();
            renderPayments();
            alert("ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¹Ù…ÙŠÙ„ ÙˆØ³Ø¬Ù„Ø§ØªÙ‡ Ø¨Ù†Ø¬Ø§Ø­.");
        }

        /**
         * @function editClient
         * @description ØªØ¹Ø¨Ø¦Ø© ÙÙˆØ±Ù… Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ù„ØºØ±Ø¶ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„.
         * @param {number} clientId - ID Ø§Ù„Ø¹Ù…ÙŠÙ„.
         */
        function editClient(clientId) {
            const clients = getFromStorage(STORAGE_KEYS.CLIENTS);
            const client = clients.find(c => c.id === clientId);

            if (client) {
                document.getElementById('client-id').value = client.id;
                document.getElementById('client-name').value = client.name;
                document.getElementById('client-phone').value = client.phone;
                document.getElementById('client-package').value = client.packageId;
                document.getElementById('client-group').value = client.groupId;
                document.getElementById('client-active').checked = client.active;
                
                document.getElementById('client-form-submit-btn').textContent = 'ØªØ¹Ø¯ÙŠÙ„';
                document.getElementById('client-form-container').style.display = 'block';
            }
        }
        
        /**
         * @function resetClientForm
         * @description ØªÙ‡ÙŠØ¦Ø© ÙÙˆØ±Ù… Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ù„Ù„Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©.
         */
        function resetClientForm() {
            document.getElementById('client-form').reset();
            document.getElementById('client-id').value = '';
            document.getElementById('client-active').checked = true;
            document.getElementById('client-form-submit-btn').textContent = 'Ø¥Ø¶Ø§ÙØ©';
            document.getElementById('client-form-container').style.display = 'block';
        }


        /**
         * @function renderClients
         * @description Ø¹Ø±Ø¶ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„ÙÙ„Ø§ØªØ±.
         */
        function renderClients() {
            const clients = getFromStorage(STORAGE_KEYS.CLIENTS);
            const packages = getFromStorage(STORAGE_KEYS.PACKAGES).reduce((acc, p) => ({ ...acc, [p.id]: p.name }), {});
            const groups = getFromStorage(STORAGE_KEYS.GROUPS).reduce((acc, g) => ({ ...acc, [g.id]: g.name }), {});
            const tableBody = document.getElementById('clients-table').getElementsByTagName('tbody')[0];
            tableBody.innerHTML = '';
            
            const searchTerm = document.getElementById('client-search').value.toLowerCase();
            const statusFilter = document.getElementById('client-status-filter').value;
            const groupFilter = document.getElementById('client-group-filter').value;

            const filteredClients = clients.filter(client => {
                const matchesSearch = client.name.toLowerCase().includes(searchTerm) || client.phone.includes(searchTerm);
                const matchesStatus = statusFilter === 'all' || (statusFilter === 'active' ? client.active : !client.active);
                const matchesGroup = groupFilter === 'all' || client.groupId === parseInt(groupFilter);
                return matchesSearch && matchesStatus && matchesGroup;
            });

            filteredClients.forEach(client => {
                const row = tableBody.insertRow();
                const packageName = packages[client.packageId] || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙØ©';
                const groupName = groups[client.groupId] || 'Ù„Ø§ Ù…Ø¬Ù…ÙˆØ¹Ø©';
                const statusText = client.active ? '<span style="color: var(--success-color); font-weight: bold;">Ù†Ø´Ø·</span>' : '<span style="color: var(--danger-color); font-weight: bold;">Ù…ÙˆÙ‚ÙˆÙ</span>';
                
                row.innerHTML = `
                    <td data-label="Ø§Ù„Ø§Ø³Ù…">${client.name}</td>
                    <td data-label="Ø§Ù„Ø±Ù‚Ù…"><a href="tel:${client.phone}">${client.phone}</a></td>
                    <td data-label="Ø§Ù„Ø¨Ø§Ù‚Ø©">${packageName}</td>
                    <td data-label="Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©">${groupName}</td>
                    <td data-label="Ø§Ù„Ø­Ø§Ù„Ø©">${statusText}</td>
                    <td data-label="ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ø¶Ø§ÙØ©">${new Date(client.createdAt).toLocaleDateString('ar-EG')}</td>
                    <td data-label="Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª">
                        <button class="btn btn-sm btn-info" onclick="editClient(${client.id})">ØªØ¹Ø¯ÙŠÙ„</button>
                        <button class="btn btn-sm btn-danger" onclick="deleteClient(${client.id})">Ø­Ø°Ù Ù†Ù‡Ø§Ø¦ÙŠ</button>
                    </td>
                `;
            });
        }
        
        /**
         * @function populateClientPackageOptions
         * @description ØªØ¹Ø¨Ø¦Ø© Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¨Ø§Ù‚Ø§Øª Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø© ÙÙŠ ÙÙˆØ±Ù… Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡.
         */
        function populateClientPackageOptions() {
            const packages = getFromStorage(STORAGE_KEYS.PACKAGES);
            const selectEl = document.getElementById('client-package');
            selectEl.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø¨Ø§Ù‚Ø©...</option>';
            packages.forEach(pkg => {
                const option = document.createElement('option');
                option.value = pkg.id;
                option.textContent = `${pkg.name} (${parseFloat(pkg.price).toFixed(2)})`;
                selectEl.appendChild(option);
            });
        }
        
        /**
         * @function populateClientGroupOptions
         * @description ØªØ¹Ø¨Ø¦Ø© Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø© ÙÙŠ ÙÙˆØ±Ù… Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ ÙˆÙÙ„Ø§ØªØ± Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡.
         */
        function populateClientGroupOptions() {
            const groups = getFromStorage(STORAGE_KEYS.GROUPS);
            const clientSelectEl = document.getElementById('client-group');
            const filterSelectEl = document.getElementById('client-group-filter');
            
            clientSelectEl.innerHTML = '<option value="">Ø§Ø®ØªØ± Ù…Ø¬Ù…ÙˆØ¹Ø©...</option>';
            filterSelectEl.innerHTML = '<option value="all">ÙƒÙ„ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª</option>';
            
            groups.forEach(group => {
                const clientOption = document.createElement('option');
                clientOption.value = group.id;
                clientOption.textContent = group.name;
                clientSelectEl.appendChild(clientOption);
                
                const filterOption = document.createElement('option');
                filterOption.value = group.id;
                filterOption.textContent = group.name;
                filterSelectEl.appendChild(filterOption);
            });
        }
        
        // Ø¥ÙŠÙÙ†Øª Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„ÙÙ„Ø§ØªØ±
        document.getElementById('client-search').addEventListener('input', renderClients);
        document.getElementById('client-status-filter').addEventListener('change', renderClients);
        document.getElementById('client-group-filter').addEventListener('change', renderClients);


        // --- 4. Ø¯ÙˆØ§Ù„ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª (Groups) ---------------------------------------------------------------------------------------------------------------------
        
        /**
         * @function saveGroup
         * @description Ø¥Ø¶Ø§ÙØ© Ø£Ùˆ ØªØ¹Ø¯ÙŠÙ„ Ù…Ø¬Ù…ÙˆØ¹Ø©.
         */
        document.getElementById('group-form').addEventListener('submit', function(event) {
            event.preventDefault();
            const id = document.getElementById('group-id').value;
            const groups = getFromStorage(STORAGE_KEYS.GROUPS);

            const newGroup = {
                id: id ? parseInt(id) : generateUniqueId(),
                name: document.getElementById('group-name').value,
                phone: document.getElementById('group-phone').value
            };

            if (id) {
                // ØªØ¹Ø¯ÙŠÙ„
                const index = groups.findIndex(g => g.id === newGroup.id);
                if (index !== -1) groups[index] = newGroup;
            } else {
                // Ø¥Ø¶Ø§ÙØ©
                groups.push(newGroup);
            }

            saveToStorage(STORAGE_KEYS.GROUPS, groups);
            document.getElementById('group-form-container').style.display = 'none';
            renderGroups();
            populateClientGroupOptions();
        });

        /**
         * @function deleteGroup
         * @description Ø­Ø°Ù Ù…Ø¬Ù…ÙˆØ¹Ø© Ø¨Ø¹Ø¯ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø§Ù„Ù…Ø±ØªØ¨Ø·ÙŠÙ†.
         * @param {number} groupId - ID Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©.
         */
        function deleteGroup(groupId) {
            const clients = getFromStorage(STORAGE_KEYS.CLIENTS);
            const linkedClientsCount = clients.filter(c => c.groupId === groupId).length;
            
            if (linkedClientsCount > 0) {
                const action = prompt(`ØªÙ†Ø¨ÙŠÙ‡: ÙŠÙˆØ¬Ø¯ ${linkedClientsCount} Ø¹Ù…ÙŠÙ„ Ù…Ø±ØªØ¨Ø· Ø¨Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©. Ø£Ø¯Ø®Ù„ 'Ø­Ø°Ù' Ù„Ù„ØªØ£ÙƒÙŠØ¯ ÙˆØ­Ø°Ù Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© (Ø³ÙŠØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø±Ø¨Ø· Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø¨Ù‡Ø§). Ø£Ùˆ Ø§Ø¶ØºØ· 'Ø¥Ù„ØºØ§Ø¡'.`);
                if (action !== 'Ø­Ø°Ù') {
                    return;
                }
                
                // Ø¥Ù„ØºØ§Ø¡ Ø±Ø¨Ø· Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø¨Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©
                clients.forEach(c => {
                    if (c.groupId === groupId) c.groupId = null;
                });
                saveToStorage(STORAGE_KEYS.CLIENTS, clients);
            } else {
                if (!confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ø£Ù†Ùƒ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŸ")) {
                    return;
                }
            }
            
            let groups = getFromStorage(STORAGE_KEYS.GROUPS);
            groups = groups.filter(g => g.id !== groupId);
            saveToStorage(STORAGE_KEYS.GROUPS, groups);
            
            renderGroups();
            populateClientGroupOptions();
            renderClients();
        }

        /**
         * @function editGroup
         * @description ØªØ¹Ø¨Ø¦Ø© ÙÙˆØ±Ù… Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ù„ØºØ±Ø¶ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„.
         * @param {number} groupId - ID Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©.
         */
        function editGroup(groupId) {
            const groups = getFromStorage(STORAGE_KEYS.GROUPS);
            const group = groups.find(g => g.id === groupId);

            if (group) {
                document.getElementById('group-id').value = group.id;
                document.getElementById('group-name').value = group.name;
                document.getElementById('group-phone').value = group.phone;
                
                document.getElementById('group-form-submit-btn').textContent = 'ØªØ¹Ø¯ÙŠÙ„';
                document.getElementById('group-form-container').style.display = 'block';
            }
        }
        
        /**
         * @function resetGroupForm
         * @description ØªÙ‡ÙŠØ¦Ø© ÙÙˆØ±Ù… Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ù„Ù„Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©.
         */
        function resetGroupForm() {
            document.getElementById('group-form').reset();
            document.getElementById('group-id').value = '';
            document.getElementById('group-form-submit-btn').textContent = 'Ø¥Ø¶Ø§ÙØ©';
            document.getElementById('group-form-container').style.display = 'block';
        }

        /**
         * @function renderGroups
         * @description Ø¹Ø±Ø¶ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª.
         */
        function renderGroups() {
            const groups = getFromStorage(STORAGE_KEYS.GROUPS);
            const clients = getFromStorage(STORAGE_KEYS.CLIENTS);
            const tableBody = document.getElementById('groups-table').getElementsByTagName('tbody')[0];
            tableBody.innerHTML = '';
            
            groups.forEach(group => {
                const clientsCount = clients.filter(c => c.groupId === group.id).length;
                const row = tableBody.insertRow();
                row.innerHTML = `
                    <td data-label="ID">${group.id}</td>
                    <td data-label="Ø§Ù„Ø§Ø³Ù…">${group.name}</td>
                    <td data-label="Ù‡Ø§ØªÙ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„"><a href="tel:${group.phone}">${group.phone}</a></td>
                    <td data-label="Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡">${clientsCount}</td>
                    <td data-label="Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª">
                        <button class="btn btn-sm btn-info" onclick="editGroup(${group.id})">ØªØ¹Ø¯ÙŠÙ„</button>
                        <button class="btn btn-sm btn-danger" onclick="deleteGroup(${group.id})">Ø­Ø°Ù</button>
                    </td>
                `;
            });
        }


        // --- 5. Ø¯ÙˆØ§Ù„ Ø§Ù„Ø¯ÙØ¹ Ø§Ù„Ø´Ù‡Ø±ÙŠ (Monthly Payments) ----------------------------------------------------------------------------------------------------------------

        /**
         * @function getPaymentEssentials
         * @description Ø¬Ù„Ø¨ Ø§Ù„Ø´Ù‡Ø± ÙˆØ§Ù„Ø³Ù†Ø© Ø§Ù„Ù…Ø®ØªØ§Ø±ÙŠÙ† Ø­Ø§Ù„ÙŠØ§Ù‹.
         * @returns {{month: number, year: number}} Ø§Ù„Ø´Ù‡Ø± ÙˆØ§Ù„Ø³Ù†Ø©.
         */
        function getPaymentEssentials() {
            const month = parseInt(document.getElementById('payment-month').value);
            const year = parseInt(document.getElementById('payment-year').value);
            return { month, year };
        }

        /**
         * @function createMonthlyRecords
         * @description Ø¥Ù†Ø´Ø§Ø¡ Ø³Ø¬Ù„Ø§Øª Ø¯ÙØ¹ Ø¬Ø¯ÙŠØ¯Ø© Ù„Ù„Ø´Ù‡Ø± ÙˆØ§Ù„Ø³Ù†Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯ÙŠÙ† Ù„Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø§Ù„Ù†Ø´Ø·ÙŠÙ†.
         */
        function createMonthlyRecords() {
            const { month, year } = getPaymentEssentials();
            if (isNaN(month) || isNaN(year) || month < 1 || month > 12 || year < 2000) {
                alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ­Ø¯ÙŠØ¯ Ø´Ù‡Ø± ÙˆØ³Ù†Ø© ØµØ­ÙŠØ­ÙŠÙ†.");
                return;
            }

            if (!confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ø£Ù†Ùƒ ØªØ±ÙŠØ¯ Ø¥Ù†Ø´Ø§Ø¡ Ø³Ø¬Ù„Ø§Øª Ø¯ÙØ¹ Ø¬Ø¯ÙŠØ¯Ø© Ù„Ø´Ù‡Ø± ${MONTH_NAMES[month-1]} ${year}ØŸ`)) {
                return;
            }
            
            const clients = getFromStorage(STORAGE_KEYS.CLIENTS).filter(c => c.active);
            const packages = getFromStorage(STORAGE_KEYS.PACKAGES).reduce((acc, p) => ({ ...acc, [p.id]: p }), {});
            let payments = getFromStorage(STORAGE_KEYS.PAYMENTS);

            let recordsCreated = 0;
            clients.forEach(client => {
                const packageData = packages[client.packageId];
                
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ø§ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø³Ø¬Ù„ Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹ Ø¨Ø§Ù„ÙØ¹Ù„ Ù„Ù‡Ø°Ø§ Ø§Ù„Ø¹Ù…ÙŠÙ„ ÙˆØ§Ù„Ø´Ù‡Ø± ÙˆØ§Ù„Ø³Ù†Ø©
                const exists = payments.some(p => p.clientId === client.id && p.month === month && p.year === year);
                
                if (!exists && packageData) {
                    const price = parseFloat(packageData.price);
                    const newRecord = {
                        id: generateUniqueId(),
                        clientId: client.id,
                        month: month,
                        year: year,
                        amount: price,
                        discount: 0.00,
                        finalAmount: price,
                        paid: false,
                        paidAt: null,
                        note: null,
                        lastReminderAt: null,
                        reminderCount: 0
                    };
                    payments.push(newRecord);
                    recordsCreated++;
                }
            });

            if (recordsCreated > 0) {
                saveToStorage(STORAGE_KEYS.PAYMENTS, payments);
                renderPayments();
                document.getElementById('payment-message').textContent = `ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ ${recordsCreated} Ø³Ø¬Ù„ Ø¯ÙØ¹ Ø¬Ø¯ÙŠØ¯.`;
                document.getElementById('payment-message').className = 'alert alert-success';
                document.getElementById('payment-message').style.display = 'block';
            } else {
                document.getElementById('payment-message').textContent = "Ù„Ù… ÙŠØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø³Ø¬Ù„Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©. Ù‚Ø¯ ØªÙƒÙˆÙ† Ù…ÙˆØ¬ÙˆØ¯Ø© Ø¨Ø§Ù„ÙØ¹Ù„ Ø£Ùˆ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¹Ù…Ù„Ø§Ø¡ Ù†Ø´Ø·ÙˆÙ†.";
                document.getElementById('payment-message').className = 'alert alert-warning';
                document.getElementById('payment-message').style.display = 'block';
            }
        }
        
        /**
         * @function updatePaymentRecord
         * @description ØªØ­Ø¯ÙŠØ« Ø³Ø¬Ù„ Ø¯ÙØ¹ Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø§Ù„Ø®ØµÙ… Ø£Ùˆ Ø­Ø§Ù„Ø© Ø§Ù„Ø¯ÙØ¹ Ø£Ùˆ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª.
         * @param {number} recordId - ID Ø³Ø¬Ù„ Ø§Ù„Ø¯ÙØ¹.
         * @param {string} type - Ù†ÙˆØ¹ Ø§Ù„ØªØ­Ø¯ÙŠØ« ('discount', 'paid', 'note').
         * @param {any} value - Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©.
         */
        function updatePaymentRecord(recordId, type, value) {
            let payments = getFromStorage(STORAGE_KEYS.PAYMENTS);
            const recordIndex = payments.findIndex(p => p.id === recordId);
            
            if (recordIndex === -1) return;

            const record = payments[recordIndex];

            if (type === 'discount') {
                const discount = parseFloat(value) || 0;
                record.discount = discount;
                record.finalAmount = parseFloat(record.amount) - discount;
                record.finalAmount = parseFloat(record.finalAmount.toFixed(2));
            } else if (type === 'paid') {
                record.paid = value; // Boolean
                record.paidAt = value ? new Date().toISOString() : null;
            } else if (type === 'note') {
                record.note = value;
            }
            
            payments[recordIndex] = record;
            saveToStorage(STORAGE_KEYS.PAYMENTS, payments);
            renderPayments(); // Ø¥Ø¹Ø§Ø¯Ø© Ø¹Ø±Ø¶ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ ÙˆØ§Ù„Ø­Ø§Ù„Ø©
            renderReports(); // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±
        }

        /**
         * @function renderPayments
         * @description Ø¹Ø±Ø¶ Ø¬Ø¯ÙˆÙ„ Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø¯ÙØ¹ Ù„Ù„Ø´Ù‡Ø± ÙˆØ§Ù„Ø³Ù†Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯ÙŠÙ†.
         */
        function renderPayments() {
            const { month, year } = getPaymentEssentials();
            
            // Ø­ÙØ¸ Ø§Ù„Ø´Ù‡Ø± ÙˆØ§Ù„Ø³Ù†Ø© Ø§Ù„Ù…Ø®ØªØ§Ø±ÙŠÙ† Ù„ÙØªØ­Ø§Øª Ø§Ù„Ù…ØªØµÙØ­ Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©
            localStorage.setItem(STORAGE_KEYS.LAST_MONTH, month);
            localStorage.setItem(STORAGE_KEYS.LAST_YEAR, year);
            
            const allPayments = getFromStorage(STORAGE_KEYS.PAYMENTS);
            const currentPayments = allPayments.filter(p => p.month === month && p.year === year);
            
            const clients = getFromStorage(STORAGE_KEYS.CLIENTS).reduce((acc, c) => ({ ...acc, [c.id]: c }), {});
            const packages = getFromStorage(STORAGE_KEYS.PACKAGES).reduce((acc, p) => ({ ...acc, [p.id]: p }), {});
            
            const tableBody = document.getElementById('payments-table').getElementsByTagName('tbody')[0];
            tableBody.innerHTML = '';
            
            let totalExpected = 0;
            let totalPaid = 0;
            
            currentPayments.forEach(record => {
                const client = clients[record.clientId];
                if (!client) return; // ØªØ¬Ø§ÙˆØ² Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø§Ù„ØªÙŠ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù„Ù‡Ø§ Ø¹Ù…Ù„Ø§Ø¡ (Ø­Ø°ÙÙˆØ§)
                const packageData = packages[client.packageId];
                
                totalExpected += record.finalAmount;
                if (record.paid) totalPaid += record.finalAmount;

                const packageName = packageData ? packageData.name : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙØ©';
                
                const row = tableBody.insertRow();
                row.innerHTML = `
                    <td data-label="Ø§Ù„Ø¹Ù…ÙŠÙ„">${client.name}</td>
                    <td data-label="Ø§Ù„Ø¨Ø§Ù‚Ø©">${packageName}</td>
                    <td data-label="Ø§Ù„Ø±Ù‚Ù…"><a href="tel:${client.phone}">${client.phone}</a></td>
                    <td data-label="Ø§Ù„Ø£ØµÙ„ÙŠ">${record.amount.toFixed(2)}</td>
                    <td data-label="Ø§Ù„Ø®ØµÙ…">
                        <input type="number" class="form-control" style="width: 80px;" value="${record.discount.toFixed(2)}" min="0" step="any"
                            onchange="updatePaymentRecord(${record.id}, 'discount', this.value)" onfocusout="this.value=parseFloat(this.value).toFixed(2)">
                    </td>
                    <td data-label="Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ" style="font-weight: bold;">${record.finalAmount.toFixed(2)}</td>
                    <td data-label="ØªÙ… Ø§Ù„Ø¯ÙØ¹ØŸ">
                        <input type="checkbox" class="paid-checkbox" ${record.paid ? 'checked' : ''}
                            onclick="updatePaymentRecord(${record.id}, 'paid', this.checked)">
                    </td>
                    <td data-label="Ù…Ù„Ø§Ø­Ø¸Ø§Øª">
                        <input type="text" class="form-control" value="${record.note || ''}"
                            onchange="updatePaymentRecord(${record.id}, 'note', this.value)">
                    </td>
                    <td data-label="Ø±Ø³Ø§Ù„Ø©">
                        <button class="btn btn-sm btn-warning" onclick="sendSmsReminder(${record.id})">SMS</button>
                    </td>
                `;
            });
            
            // ØªØ­Ø¯ÙŠØ« Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¯ÙØ¹
            updatePaymentStats(totalExpected, totalPaid);
            
            // ØªØ­Ø¯ÙŠØ« ØµÙØ­Ø© Ø§Ù„Ù…ØªØ£Ø®Ø±ÙŠÙ† Ø£ÙŠØ¶Ø§Ù‹
            renderDebtors();
            // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù‚Ø³Ù… Ù†Ø´Ø·Ù‹Ø§
            if (document.getElementById('reports').style.display === 'block') {
                 renderReports();
            }
        }

        /**
         * @function updatePaymentStats
         * @description ØªØ­Ø¯ÙŠØ« Ø¨Ø·Ø§Ù‚Ø§Øª Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¯ÙØ¹ Ø§Ù„Ø´Ù‡Ø±ÙŠ.
         * @param {number} totalExpected - Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…ØªÙˆÙ‚Ø¹.
         * @param {number} totalPaid - Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø¯ÙÙˆØ¹.
         */
        function updatePaymentStats(totalExpected, totalPaid) {
            const totalDue = totalExpected - totalPaid;
            const collectionRatio = totalExpected > 0 ? (totalPaid / totalExpected) * 100 : 0;

            document.getElementById('stat-expected').textContent = totalExpected.toFixed(2);
            document.getElementById('stat-paid').textContent = totalPaid.toFixed(2);
            document.getElementById('stat-due').textContent = totalDue.toFixed(2);
            document.getElementById('stat-ratio').textContent = `${collectionRatio.toFixed(1)}%`;
        }

        // --- 6 & 7. Ø¯ÙˆØ§Ù„ Ø¥Ø±Ø³Ø§Ù„ SMS ÙˆÙ‚ÙˆØ§Ù„Ø¨ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ ------------------------------------------------------------------------------------------------------------------

        /**
         * @function getSmsTemplate
         * @description ÙŠØ¬Ù„Ø¨ Ù‚Ø§Ù„Ø¨ Ø±Ø³Ø§Ù„Ø© SMS Ù…Ù† localStorage.
         * @returns {string} Ù‚Ø§Ù„Ø¨ Ø§Ù„Ø±Ø³Ø§Ù„Ø©.
         */
        function getSmsTemplate() {
            // Ø¬Ù„Ø¨ Ø§Ù„Ù‚Ø§Ù„Ø¨ ÙƒÙ†Øµ
            return getFromStorage(STORAGE_KEYS.SMS_TEMPLATE, DEFAULT_SMS_TEMPLATE); 
        }

        /**
         * @function saveSmsTemplate
         * @description ÙŠØ­ÙØ¸ Ù‚Ø§Ù„Ø¨ Ø±Ø³Ø§Ù„Ø© SMS Ù…Ù† textarea.
         */
        function saveSmsTemplate() {
            const template = document.getElementById('sms-template-input').value;
            // Ø­ÙØ¸ Ø§Ù„Ù‚Ø§Ù„Ø¨ ÙƒÙ†Øµ
            saveToStorage(STORAGE_KEYS.SMS_TEMPLATE, template); 
            document.getElementById('payment-message').textContent = "ØªÙ… Ø­ÙØ¸ Ù‚Ø§Ù„Ø¨ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø¨Ù†Ø¬Ø§Ø­.";
            document.getElementById('payment-message').className = 'alert alert-success';
            document.getElementById('payment-message').style.display = 'block';
        }
        
        /**
         * @function resetSmsTemplate
         * @description Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ù‚Ø§Ù„Ø¨ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ù„Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©.
         */
        function resetSmsTemplate() {
            if (confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù‚Ø§Ù„Ø¨ Ù„Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©ØŸ")) {
                 saveToStorage(STORAGE_KEYS.SMS_TEMPLATE, DEFAULT_SMS_TEMPLATE);
                 document.getElementById('sms-template-input').value = DEFAULT_SMS_TEMPLATE;
                 document.getElementById('payment-message').textContent = "ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù‚Ø§Ù„Ø¨ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ.";
                 document.getElementById('payment-message').className = 'alert alert-success';
                 document.getElementById('payment-message').style.display = 'block';
            }
        }


        /**
         * @function applyTemplate
         * @description Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª ÙÙŠ Ø§Ù„Ù‚Ø§Ù„Ø¨ Ø¨Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.
         * @param {string} template - Ø§Ù„Ù‚Ø§Ù„Ø¨ Ø§Ù„Ø°ÙŠ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ {{Ù…ØªØºÙŠØ±Ø§Øª}}.
         * @param {Object} data - Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (name, month, year, amount).
         * @returns {string} Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©.
         */
        function applyTemplate(template, data) {
            let message = template;
            message = message.replace(/{{name}}/g, data.name || '');
            message = message.replace(/{{month}}/g, data.month || '');
            message = message.replace(/{{year}}/g, data.year || '');
            message = message.replace(/{{amount}}/g, data.amount ? data.amount.toFixed(2) : '0.00');
            return encodeURIComponent(message);
        }


        /**
         * @function sendSmsReminder
         * @description Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© SMS ÙØ±Ø¯ÙŠØ© Ù„Ø¹Ù…ÙŠÙ„ Ù…ØªØ£Ø®Ø±.
         * @param {number} recordId - ID Ø³Ø¬Ù„ Ø§Ù„Ø¯ÙØ¹.
         */
        function sendSmsReminder(recordId) {
            let payments = getFromStorage(STORAGE_KEYS.PAYMENTS);
            const recordIndex = payments.findIndex(p => p.id === recordId);
            const record = payments[recordIndex];
            
            if (!record) return;

            const clients = getFromStorage(STORAGE_KEYS.CLIENTS).reduce((acc, c) => ({ ...acc, [c.id]: c }), {});
            const client = clients[record.clientId];
            
            if (!client || !client.phone) {
                alert("Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø±Ù‚Ù… Ù‡Ø§ØªÙ Ù…Ø³Ø¬Ù„ Ù„Ù‡Ø°Ø§ Ø§Ù„Ø¹Ù…ÙŠÙ„.");
                return;
            }

            const templateData = {
                name: client.name,
                month: MONTH_NAMES[record.month - 1],
                year: record.year,
                amount: record.finalAmount
            };
            
            const messageBody = applyTemplate(getSmsTemplate(), templateData);
            const smsLink = `sms:${client.phone}?body=${messageBody}`;

            // ÙØªØ­ Ø±Ø§Ø¨Ø· SMS
            window.open(smsLink, '_blank');
            
            // ØªØ­Ø¯ÙŠØ« Ø³Ø¬Ù„ Ø§Ù„ØªØ°ÙƒÙŠØ±
            record.lastReminderAt = new Date().toISOString();
            record.reminderCount = (record.reminderCount || 0) + 1;
            payments[recordIndex] = record;
            saveToStorage(STORAGE_KEYS.PAYMENTS, payments);
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
            if (document.getElementById('debtors').style.display === 'block') {
                 renderDebtors();
            }
        }

        /**
         * @function sendBulkSmsReminder
         * @description Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© SMS Ø¬Ù…Ø§Ø¹ÙŠØ© Ù„Ù„Ù…ØªØ£Ø®Ø±ÙŠÙ†.
         */
        function sendBulkSmsReminder() {
            if (!confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ø£Ù†Ùƒ ØªØ±ÙŠØ¯ Ù…Ø­Ø§ÙˆÙ„Ø© Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© Ø¬Ù…Ø§Ø¹ÙŠØ© Ù„ÙƒÙ„ Ø§Ù„Ù…ØªØ£Ø®Ø±ÙŠÙ†ØŸ")) {
                return;
            }
            
            const { month, year } = getPaymentEssentials();
            let payments = getFromStorage(STORAGE_KEYS.PAYMENTS);
            const clients = getFromStorage(STORAGE_KEYS.CLIENTS).reduce((acc, c) => ({ ...acc, [c.id]: c }), {});
            
            const debtors = payments.filter(p => p.month === month && p.year === year && p.paid === false);
            
            if (debtors.length === 0) {
                alert("Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…ØªØ£Ø®Ø±ÙŠÙ† ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±.");
                return;
            }
            
            const phones = debtors.map(d => clients[d.clientId]?.phone).filter(p => p);
            const phoneList = phones.join(',');

            // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ø³Ù… Ø¹Ø§Ù… ÙÙŠ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠØ©
            const templateData = {
                name: "Ø§Ù„Ø¹Ù…ÙŠÙ„", 
                month: MONTH_NAMES[month - 1],
                year: year,
                amount: debtors.reduce((sum, d) => sum + d.finalAmount, 0) / debtors.length // Ù…ØªÙˆØ³Ø· Ø§Ù„Ù…Ø¨Ù„Øº
            };
            
            const messageBody = applyTemplate(getSmsTemplate(), templateData);
            const smsLink = `sms:${phoneList}?body=${messageBody}`;

            // ÙØªØ­ Ø±Ø§Ø¨Ø· SMS
            window.open(smsLink, '_blank');
            
            // ØªØ­Ø¯ÙŠØ« Ø³Ø¬Ù„ Ø§Ù„ØªØ°ÙƒÙŠØ± Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ØªØ£Ø®Ø±ÙŠÙ†
            payments = payments.map(p => {
                if (p.month === month && p.year === year && p.paid === false) {
                    p.lastReminderAt = new Date().toISOString();
                    p.reminderCount = (p.reminderCount || 0) + 1;
                }
                return p;
            });
            saveToStorage(STORAGE_KEYS.PAYMENTS, payments);
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
            renderDebtors();
        }

        /**
         * @function renderDebtors
         * @description Ø¹Ø±Ø¶ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…ØªØ£Ø®Ø±ÙŠÙ†.
         */
        function renderDebtors() {
            // Ø¹Ø±Ø¶ Ø§Ù„Ù‚Ø§Ù„Ø¨ Ø§Ù„Ø­Ø§Ù„ÙŠ
            document.getElementById('sms-template-input').value = getSmsTemplate();

            const { month, year } = getPaymentEssentials();
            const allPayments = getFromStorage(STORAGE_KEYS.PAYMENTS);
            const debtorsRecords = allPayments.filter(p => p.month === month && p.year === year && p.paid === false);
            
            const clients = getFromStorage(STORAGE_KEYS.CLIENTS).reduce((acc, c) => ({ ...acc, [c.id]: c }), {});
            
            const tableBody = document.getElementById('debtors-table').getElementsByTagName('tbody')[0];
            tableBody.innerHTML = '';

            debtorsRecords.forEach(record => {
                const client = clients[record.clientId];
                if (!client) return;
                
                const lastReminder = record.lastReminderAt 
                    ? new Date(record.lastReminderAt).toLocaleDateString('ar-EG') 
                    : 'Ù„Ù… ÙŠØ±Ø³Ù„';
                
                const row = tableBody.insertRow();
                row.innerHTML = `
                    <td data-label="Ø§Ù„Ø¹Ù…ÙŠÙ„">${client.name}</td>
                    <td data-label="Ø§Ù„Ø±Ù‚Ù…"><a href="tel:${client.phone}">${client.phone}</a></td>
                    <td data-label="Ø§Ù„Ù…Ø¨Ù„Øº">${record.finalAmount.toFixed(2)}</td>
                    <td data-label="Ø¹Ø¯Ø¯ Ø§Ù„ØªØ°ÙƒÙŠØ±Ø§Øª">${record.reminderCount || 0}</td>
                    <td data-label="Ø¢Ø®Ø± ØªØ°ÙƒÙŠØ±">${lastReminder}</td>
                    <td data-label="Ø¥Ø±Ø³Ø§Ù„ SMS">
                        <button class="btn btn-sm btn-warning" onclick="sendSmsReminder(${record.id})">SMS ÙØ±Ø¯ÙŠ</button>
                    </td>
                `;
            });
        }


        // --- 9. Ø¯ÙˆØ§Ù„ Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ (Backup & Restore) -------------------------------------------------------------------------------------------------------------

        /**
         * @function exportDataToJSON
         * @description ØªØµØ¯ÙŠØ± Ø¨ÙŠØ§Ù†Ø§Øª localStorage Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ø¥Ù„Ù‰ Ù…Ù„Ù JSON.
         */
        function exportDataToJSON() {
            const dataToExport = {
                clients: getFromStorage(STORAGE_KEYS.CLIENTS),
                packages: getFromStorage(STORAGE_KEYS.PACKAGES),
                groups: getFromStorage(STORAGE_KEYS.GROUPS),
                payments: getFromStorage(STORAGE_KEYS.PAYMENTS),
                // Ø¬Ù„Ø¨ Ø§Ù„Ù‚Ø§Ù„Ø¨ ÙƒÙ†Øµ
                smsReminderTemplate: getFromStorage(STORAGE_KEYS.SMS_TEMPLATE, DEFAULT_SMS_TEMPLATE) 
                // Ù„Ø§ ÙŠØªÙ… ØªØ¶Ù…ÙŠÙ† ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± Ø£Ùˆ Ø­Ø§Ù„Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„
            };

            const jsonString = JSON.stringify(dataToExport, null, 2);
            const blob = new Blob([jsonString], { type: 'application/json' });
            const url = URL.createObjectURL(blob);

            const a = document.createElement('a');
            a.href = url;
            a.download = `backup-${new Date().toISOString().slice(0, 10)}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            alert("ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­ Ø¥Ù„Ù‰ Ù…Ù„Ù backup.json!");
        }

        /**
         * @function validateImportedData
         * @description Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ù…ÙØ§ØªÙŠØ­ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© ÙÙŠ Ù…Ù„Ù Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯.
         * @param {Object} data - Ø¨ÙŠØ§Ù†Ø§Øª JSON Ø§Ù„Ù…Ø³ØªÙˆØ±Ø¯Ø©.
         * @returns {boolean} - true Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØµØ§Ù„Ø­Ø©.
         */
        function validateImportedData(data) {
            const requiredKeys = ['clients', 'packages', 'groups', 'payments', 'smsReminderTemplate'];
            return requiredKeys.every(key => data.hasOwnProperty(key));
        }

        /**
         * @function importDataFromInput
         * @description Ø¨Ø¯Ø¡ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù…Ù† Ù…Ù„Ù Ù…Ø­Ø¯Ø¯.
         */
        function importDataFromInput() {
            const fileInput = document.getElementById('import-file-input');
            const file = fileInput.files[0];

            if (!file) {
                alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù JSON Ù„Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯.");
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    
                    if (!validateImportedData(importedData)) {
                        alert("ÙØ´Ù„ Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯: Ù…Ù„Ù JSON ØºÙŠØ± ØµØ§Ù„Ø­. Ø§Ù„Ù…ÙØ§ØªÙŠØ­ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ù…ÙÙ‚ÙˆØ¯Ø©.");
                        return;
                    }

                    if (!confirm("ØªØ­Ø°ÙŠØ±: Ø³ÙŠØªÙ… Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©. Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©ØŸ")) {
                        return;
                    }
                    
                    // ÙƒØªØ§Ø¨Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªÙˆØ±Ø¯Ø© Ø¥Ù„Ù‰ localStorage
                    saveToStorage(STORAGE_KEYS.CLIENTS, importedData.clients || []);
                    saveToStorage(STORAGE_KEYS.PACKAGES, importedData.packages || []);
                    saveToStorage(STORAGE_KEYS.GROUPS, importedData.groups || []);
                    saveToStorage(STORAGE_KEYS.PAYMENTS, importedData.payments || []);
                    // Ø­ÙØ¸ Ø§Ù„Ù‚Ø§Ù„Ø¨ ÙƒÙ†Øµ
                    saveToStorage(STORAGE_KEYS.SMS_TEMPLATE, importedData.smsReminderTemplate || DEFAULT_SMS_TEMPLATE); 
                    
                    alert("ØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­! Ø³ÙŠØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©.");
                    location.reload();

                } catch (error) {
                    alert(`ÙØ´Ù„ Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯: Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù…Ù„Ù. ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù†Ù‡ Ù…Ù„Ù JSON Ø³Ù„ÙŠÙ….\nØ§Ù„Ø®Ø·Ø£: ${error.message}`);
                    console.error('Import Error:', error);
                }
            };

            reader.readAsText(file);
        }

        // --- 11. Ø¯ÙˆØ§Ù„ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± (Reports) --------------------------------------------------------------------------------------------------------------------------

        /**
         * @function renderReports
         * @description Ø¥Ù†Ø´Ø§Ø¡ ÙˆØ¹Ø±Ø¶ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª ÙˆØ§Ù„ØªÙ‚Ø§Ø±ÙŠØ±.
         */
        function renderReports() {
            const clients = getFromStorage(STORAGE_KEYS.CLIENTS);
            const groups = getFromStorage(STORAGE_KEYS.GROUPS);
            const payments = getFromStorage(STORAGE_KEYS.PAYMENTS);
            
            // 1. Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø¹Ø§Ù…Ø©
            const activeClients = clients.filter(c => c.active).length;
            const inactiveClients = clients.length - activeClients;
            
            const statsHtml = `
                <div class="card bg-info"><h4>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</h4><p>${clients.length}</p></div>
                <div class="card bg-success"><h4>Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø§Ù„Ù†Ø´Ø·ÙˆÙ†</h4><p>${activeClients}</p></div>
                <div class="card bg-danger"><h4>Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø§Ù„Ù…ÙˆÙ‚ÙˆÙÙˆÙ†</h4><p>${inactiveClients}</p></div>
            `;
            document.getElementById('reports-stats').innerHTML = statsHtml;
            
            // 2. Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª
            const groupStats = groups.map(group => {
                const total = clients.filter(c => c.groupId === group.id).length;
                const active = clients.filter(c => c.groupId === group.id && c.active).length;
                const inactive = total - active;
                return { name: group.name, total, active, inactive };
            });

            const groupTableBody = document.getElementById('group-reports-table').getElementsByTagName('tbody')[0];
            groupTableBody.innerHTML = '';
            groupStats.forEach(stat => {
                const row = groupTableBody.insertRow();
                row.innerHTML = `
                    <td data-label="Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©">${stat.name}</td>
                    <td data-label="Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡">${stat.total}</td>
                    <td data-label="Ø¹Ù…Ù„Ø§Ø¡ Ù†Ø´Ø·ÙˆÙ†">${stat.active}</td>
                    <td data-label="Ø¹Ù…Ù„Ø§Ø¡ Ù…ÙˆÙ‚ÙˆÙÙˆÙ†">${stat.inactive}</td>
                `;
            });
            
            // 3. Ù…Ù„Ø®Øµ Ø§Ù„Ø¯ÙØ¹ Ø§Ù„Ø´Ù‡Ø±ÙŠ Ø§Ù„Ø­Ø§Ù„ÙŠ
            const { month, year } = getPaymentEssentials();
            const currentPayments = payments.filter(p => p.month === month && p.year === year);
            
            let summary = `<div class="alert alert-warning">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø³Ø¬Ù„Ø§Øª Ø¯ÙØ¹ Ù„Ù„Ø´Ù‡Ø± Ø§Ù„Ù…Ø®ØªØ§Ø±: ${MONTH_NAMES[month-1]} / ${year}.</div>`;

            if (currentPayments.length > 0) {
                const paidCount = currentPayments.filter(p => p.paid).length;
                const debtorCount = currentPayments.length - paidCount;
                const totalExpected = currentPayments.reduce((sum, p) => sum + p.finalAmount, 0);
                const totalPaid = currentPayments.filter(p => p.paid).reduce((sum, p) => sum + p.finalAmount, 0);
                const collectionRatio = totalExpected > 0 ? (totalPaid / totalExpected) * 100 : 0;
                
                summary = `
                    <p>Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ: <mark>${MONTH_NAMES[month-1]} / ${year}</mark></p>
                    <div class="dashboard-cards" id="monthly-report-cards" style="margin-top: 10px;">
                        <div class="card bg-info"><h4>Ø¹Ø¯Ø¯ Ø§Ù„Ø³Ø¬Ù„Ø§Øª</h4><p>${currentPayments.length}</p></div>
                        <div class="card bg-success"><h4>Ø¹Ø¯Ø¯ Ø§Ù„Ø°ÙŠÙ† Ø¯ÙØ¹ÙˆØ§</h4><p>${paidCount}</p></div>
                        <div class="card bg-danger"><h4>Ø¹Ø¯Ø¯ Ø§Ù„Ù…ØªØ£Ø®Ø±ÙŠÙ†</h4><p>${debtorCount}</p></div>
                        <div class="card bg-warning"><h4>Ù†Ø³Ø¨Ø© Ø§Ù„ØªØ­ØµÙŠÙ„</h4><p>${collectionRatio.toFixed(1)}%</p></div>
                    </div>
                `;
            }
            document.getElementById('monthly-payment-summary').innerHTML = summary;
        }

        // --- ğŸŒ Ø¯ÙˆØ§Ù„ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø¹Ø§Ù…Ø© ---------------------------------------------------------------------------------------------------------------------------------

        /**
         * @function showSection
         * @description Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ ÙˆØ¥Ø®ÙØ§Ø¡ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ø£Ø®Ø±Ù‰ ÙˆØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ù€ Navbar.
         * @param {string} sectionId - ID Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ù…Ø±Ø§Ø¯ Ø¥Ø¸Ù‡Ø§Ø±Ù‡.
         * @param {HTMLElement} navItem - Ø¹Ù†ØµØ± Ø§Ù„Ù€ Navbar Ø§Ù„Ø°ÙŠ ØªÙ… Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„ÙŠÙ‡.
         */
        function showSection(sectionId, navItem) {
            // Ø¥Ø®ÙØ§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…
            document.querySelectorAll('.content-section').forEach(section => {
                section.style.display = 'none';
            });

            // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ù…Ø·Ù„ÙˆØ¨
            const targetSection = document.getElementById(sectionId);
            if (targetSection) {
                targetSection.style.display = 'block';
            }

            // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ù€ Navbar
            document.querySelectorAll('.nav-item a').forEach(a => {
                a.classList.remove('active');
            });
            if (navItem) {
                navItem.classList.add('active');
            }

            // Ø¥Ø¹Ø§Ø¯Ø© Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù†Ø¯ Ø§Ù„ØªØ¨Ø¯ÙŠÙ„
            if (sectionId === 'clients') {
                renderClients();
            } else if (sectionId === 'packages') {
                renderPackages();
            } else if (sectionId === 'groups') {
                renderGroups();
            } else if (sectionId === 'payments') {
                renderPayments();
            } else if (sectionId === 'debtors') {
                renderDebtors();
            } else if (sectionId === 'reports') {
                renderReports();
            }
        }
        
        /**
         * @function initializeInterface
         * @description Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø¨Ø¹Ø¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„.
         */
        function initializeInterface() {
            // ØªÙ‡ÙŠØ¦Ø© Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø´Ù‡Ø± ÙˆØ§Ù„Ø³Ù†Ø©
            const today = new Date();
            const currentMonth = today.getMonth() + 1;
            const currentYear = today.getFullYear();
            
            const lastMonth = localStorage.getItem(STORAGE_KEYS.LAST_MONTH) || currentMonth;
            const lastYear = localStorage.getItem(STORAGE_KEYS.LAST_YEAR) || currentYear;

            document.getElementById('payment-month').value = lastMonth;
            document.getElementById('payment-year').value = lastYear;
            
            // ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø©
            populateClientPackageOptions();
            populateClientGroupOptions();
            
            // Ø¹Ø±Ø¶ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ù…Ø¨Ø¯Ø¦ÙŠØ©
            renderClients();
            renderPackages();
            renderGroups();
            renderPayments();
        }

        // --- ğŸš€ Ø¨Ø¯Ø¡ ØªØ´ØºÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ---------------------------------------------------------------------------------------------------------------------------------
        
        // 1. ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© (ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± ÙˆØ§Ù„Ù‚ÙˆØ§Ù„Ø¨ ÙˆØ§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©)
        initializeData();

        // 2. Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø§Ù„Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙˆØ¨Ø¯Ø¡ Ø§Ù„ØªØ´ØºÙŠÙ„
        checkLoginStatus();

        // 3. Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¬Ù„Ø§Ù‹ Ø¯Ø®ÙˆÙ„Ù‡ Ø¨Ø§Ù„ÙØ¹Ù„ØŒ Ù‚Ù… Ø¨ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©.
        if (getFromStorage(STORAGE_KEYS.LOGGED_IN, 'false') === 'true') {
            initializeInterface();
        }
        
        // --- End of JavaScript ---------------------------------------------------------------------------------------------------------------------------------------
    </script>
</body>
</html>
